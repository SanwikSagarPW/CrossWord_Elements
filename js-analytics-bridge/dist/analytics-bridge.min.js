!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).AnalyticsManager=e()}(this,function(){"use strict";class t{constructor(){if(t.instance)return t.instance;this._isInitialized=!1,this._gameId="",this._sessionName="",this._reportData={gameId:"",name:"",xpEarnedTotal:0,rawData:[],diagnostics:{levels:[]}},t.instance=this}static getInstance(){return t.instance||(t.instance=new t),t.instance}initialize(t,e){this._gameId=t,this._sessionName=e,this._reportData.gameId=t,this._reportData.name=e,this._reportData.diagnostics.levels=[],this._reportData.rawData=[],this._reportData.xpEarnedTotal=0,this._isInitialized=!0,console.log(`[Analytics] Initialized for: ${t}`)}addRawMetric(t,e){this._isInitialized?this._reportData.rawData.push({key:t,value:String(e)}):console.warn("[Analytics] Not initialized")}startLevel(t){if(!this._isInitialized)return void console.warn("[Analytics] Not initialized");const e={levelId:t,successful:!1,timeTaken:0,timeDirection:!1,xpEarned:0,tasks:[]};this._reportData.diagnostics.levels.push(e)}endLevel(t,e,i,n){const a=this._getLevelById(t);a?(a.successful=e,a.timeTaken=i,a.xpEarned=n,this._reportData.xpEarnedTotal+=n):console.warn(`[Analytics] End Level called for unknown level: ${t}`)}recordTask(t,e,i,n,a,s,o){const r=this._getLevelById(t);if(r){const t={taskId:e,question:i,options:"[]",correctChoice:n,choiceMade:a,successful:n===a,timeTaken:s,xpEarned:o};r.tasks.push(t)}else console.warn(`[Analytics] Record Task called for unknown level: ${t}`)}submitReport(){if(!this._isInitialized)return void console.error("[Analytics] Attempted to submit without initialization.");const t=JSON.parse(JSON.stringify(this._reportData));if(t.sessionId||(t.sessionId=Date.now()+"-"+Math.random().toString(36)),t.timestamp||(t.timestamp=(new Date).toISOString()),t.xpEarned=t.xpEarned||t.xpEarnedTotal||0,t.xpTotal=t.xpTotal||t.xpEarnedTotal||0,t.bestXp=t.bestXp||t.xpEarnedTotal||0,"undefined"==typeof window)return t;const e="ignite_pending_sessions_jsplugin";function i(t){let e=!1;try{window.myJsAnalytics&&"function"==typeof window.myJsAnalytics.trackGameSession&&(window.myJsAnalytics.trackGameSession(t),e=!0)}catch(t){}try{window.ReactNativeWebView&&"function"==typeof window.ReactNativeWebView.postMessage&&(window.ReactNativeWebView.postMessage(JSON.stringify(t)),e=!0)}catch(t){}try{const i=window.__GodotAnalyticsParentOrigin||"*";window.parent.postMessage(t,i),e=!0}catch(t){}if(!e)try{console.log("Payload:"+JSON.stringify(t))}catch(t){}return e}function n(){try{const t=JSON.parse(localStorage.getItem(e)||"[]");if(!t||!t.length)return;t.forEach(function(t){i(t)}),localStorage.removeItem(e)}catch(t){}}i(t)||function(t){try{const i=JSON.parse(localStorage.getItem(e)||"[]");i.push(t),localStorage.setItem(e,JSON.stringify(i))}catch(t){}}(t);try{"undefined"!=typeof window&&(window.addEventListener&&window.addEventListener("online",n),window.addEventListener&&window.addEventListener("load",n),window.addEventListener&&window.addEventListener("message",function(t){try{const e="string"==typeof t.data?JSON.parse(t.data):t.data;e&&"ANALYTICS_CONFIG"===e.type&&e.parentOrigin&&(window.__GodotAnalyticsParentOrigin=e.parentOrigin)}catch(t){}}),setTimeout(n,2e3))}catch(t){}}getReportData(){return JSON.parse(JSON.stringify(this._reportData))}reset(){this._reportData.xpEarnedTotal=0,this._reportData.rawData=[],this._reportData.diagnostics.levels=[],console.log("[Analytics] Data reset")}_getLevelById(t){const e=this._reportData.diagnostics.levels;for(let i=e.length-1;i>=0;i--)if(e[i].levelId===t)return e[i];return null}}return t});
